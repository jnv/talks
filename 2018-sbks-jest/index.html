<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Jest: Co možná neznáte</title>
    <link rel="shortcut icon" href="./../favicon.ico" />
    <link rel="stylesheet" href="./../dist/reset.css" />
    <link rel="stylesheet" href="./../dist/reveal.css" />
    <link rel="stylesheet" href="./../dist/theme/black.css" id="theme" />
    <link rel="stylesheet" href="./../css/highlight/zenburn.css" />


  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template">

# Jest 🃏

## Co možná neznáte

Jan Vlnas, Tech Talks #7<br>13. 8. 2018
</script></section><section  data-markdown><script type="text/template">
# Historie
</script></section><section  data-markdown><script type="text/template">
## 2014

![Jasmine](img/jasmine.svg)
</script></section><section  data-markdown><script type="text/template">
> Talking to other parts of the business who ‘failed to adopt’ Jest, they would tell us that it was a pain to set up, that it would crash silently in the background without alerting anyone and when they tried to actually use it, it required an older version of NodeJS. Whaat?

<small>[Painless JavaScript testing? Surely you Jest! (2015)](https://rea.tech/painless-javascript-testing-surely-you-jest/)</small>
</script></section><section  data-markdown><script type="text/template">
## 2016

> …people working on Jest moved on to other projects within Facebook.
>
> As engineers added more and more tests though, we noticed the performance of Jest wasn't going to scale.

<small>[JavaScript Unit Testing Performance (2016)](https://jestjs.io/blog/2016/03/11/javascript-unit-testing-performance)</small>
</script></section><section  data-markdown><script type="text/template">
![create-react-app](img/create-react-app.png)
</script></section><section  data-markdown><script type="text/template">
## 2017

![Aribnb](img/airbnb.png)
</script></section><section  data-markdown><script type="text/template">
> Running our test suite with Mocha took 12+ minutes. In CI […] we’re now able to run the entire Jest suite in 4 minutes 30 seconds.

<small>[Migrating from Mocha to Jest](https://medium.com/airbnb-engineering/unlocking-test-performance-migrating-from-mocha-to-jest-2796c508ec50)</small>
</script></section><section  data-markdown><script type="text/template">
# Proč Jest?
</script></section><section  data-markdown><script type="text/template">
- Minimální konfigurace
  - Runner, assertions, mocking, snapshots <!-- .element: class="fragment" -->
- Rychlost <!-- .element: class="fragment" -->
- <!-- .element: class="fragment" --> [Přívětivost](https://itnext.io/reasons-to-love-jest-the-developer-experience-b00ec93df7bb)
- Zpětná vazba <!-- .element: class="fragment" -->
</script></section><section  data-markdown><script type="text/template">
# Jak se používá
</script></section><section  data-markdown><script type="text/template">
### Kam s testy

- Adresář: `__tests__`
- Soubory: `*.test.js(x)`
</script></section><section  data-markdown><script type="text/template">
```js
// __tests__/sum.js
const { sum } = require("../sum");

describe(".sum", () => {
  test("adds 1 + 2 to equal 3", () => {
    expect(sum(1, 2)).toBe(3);
  });
});
```
</script></section><section  data-markdown><script type="text/template">
```js
// __tests__/sum.js
const { sum } = require("../sum");

describe(".sum", () => {
  it("adds two numbers", () => {
    expect(sum(1, 2)).toBe(3);
  });
});
```

<small>[Better Specs: Don't use should](http://www.betterspecs.org/#should)</small>
</script></section><section  data-markdown><script type="text/template">
## Parametrické testy
</script></section><section  data-markdown><script type="text/template">
```js
// Array syntax
test.each([
  [1, 1, 2],
  [1, 2, 3],
  [2, 1, 3],
])(".sum(%i, %i) => %i", (a, b, expected) => {
  expect(sum(a, b)).toBe(expected);
});
```
</script></section><section  data-markdown><script type="text/template">
```js
test.each`
  a    | b    | expected
  ${1} | ${1} | ${2}
  ${1} | ${2} | ${3}
  ${2} | ${1} | ${3}
`("returns $expected for sum($a, $b)", ({ a, b, expected }) => {
  expect(sum(a, b)).toBe(expected);
});
```
</script></section><section  data-markdown><script type="text/template">
## [Mockování funkcí](https://jestjs.io/docs/en/mock-functions)
</script></section><section  data-markdown><script type="text/template">
### `jest.fn`

```js
const myMock = jest.fn();

myMock(1, 2);

expect(myMock).toHaveBeenCalled();
expect(myMock).toHaveBeenLastCalledWith(1, 2);
```
</script></section><section  data-markdown><script type="text/template">
### `jest.spyOn`

```js
const nowSpy = jest.spyOn(Date, "now");
Date.now();
expect(nowSpy).toHaveBeenCalled();
```
</script></section><section  data-markdown><script type="text/template">
### Mockování času

```js
const mockedDate = Date.UTC(2018, 5, 1);
const nowSpy = jest.spyOn(Date, "now").mockImplementation(() => mockedDate);

// ...later
nowSpy.mockRestore();
```
</script></section><section  data-markdown><script type="text/template">
## [Mockování modulů](https://jestjs.io/docs/en/manual-mocks)
</script></section><section  data-markdown><script type="text/template">
```js
// modul.js

const randomNumber = require("random-number");

exports.randomIndex = () => {
  return "someIndex-" + randomNumber();
};
```

```js
// modul.test.js

expect(randomIndex()).toBe("someIndex-4");
```
</script></section><section  data-markdown><script type="text/template">
```
.
├── node_modules
│   └── random-number
├── __mocks__
│   └── random-number.js
└── src
    └── modul.js
```
</script></section><section  data-markdown><script type="text/template">
```js
// __mocks__/random-number.js

module.exports = () => 4;
```
</script></section><section  data-markdown><script type="text/template">
### [`jest.mock`](https://jestjs.io/docs/en/jest-object#jestmockmodulename-factory-options)

- Standardní moduly <br> `jest.mock('fs')` <!-- .element: class="fragment" -->
- In-line definice mocku <!-- .element: class="fragment" -->
</script></section><section  data-markdown><script type="text/template">
```js
jest.mock("../module-name", () => {
  return jest.fn(() => 42);
});

const moduleName = require("../module-name");
moduleName(); // => 42
```
</script></section><section  data-markdown><script type="text/template">
### Více mockování

- [Fake timers](https://jestjs.io/docs/en/timer-mocks) (`setTimeout`, `setInterval`…)
- [Automocking](https://jestjs.io/docs/en/configuration.html#automock-boolean)
</script></section><section  data-markdown><script type="text/template">
## ⚠️

Jest automaticky nevyčistí volání mocků mezi testy.

- Explicitně: `jest.clearAllMocks()`
- [V nastavení](https://jestjs.io/docs/en/configuration.html#clearmocks-boolean): `clearMocks: true`
</script></section><section  data-markdown><script type="text/template">
## [Immersive Watch Mode](http://facebook.github.io/jest/blog/2017/02/21/jest-19-immersive-watch-mode-test-platform-improvements.html)
</script></section><section  data-markdown><script type="text/template">
```sh
npx jest --watch
```
</script></section><section  data-markdown><script type="text/template">
[![asciicast](https://asciinema.org/a/ndh9L1WBhfBPJCCbR3suyGfjs.png)](https://asciinema.org/a/ndh9L1WBhfBPJCCbR3suyGfjs?size=medium) <!-- .element class="stretch" target="_blank" -->
</script></section><section  data-markdown><script type="text/template">
## [Snapshot Testing](https://jestjs.io/docs/en/snapshot-testing.html)
</script></section><section  data-markdown><script type="text/template">
```js
expect({ some: "object" }).toMatchSnapshot();
```

```js
// __snapshots__/test-filename.js.snap
exports[`snapshot example 1`] = `
Object {
  "some": "object",
}
`;
```

<!-- .element: class="fragment" -->
</script></section><section  data-markdown><script type="text/template">
```js
expect({ some: "object" }).toMatchSnapshot();
```

```js
expect({ some: "object", other: "stuff" }).toMatchSnapshot();
```
</script></section><section  data-markdown><script type="text/template">
![snap fail](img/snap-fail.png)
</script></section><section  data-markdown><script type="text/template">
```sh
npx jest -u
```

```js
// __snapshots__/test-filename.js.snap
exports[`snapshot example 1`] = `
Object {
  "other": "stuff",
  "some": "object",
}
`;
```
</script></section><section  data-markdown><script type="text/template">
### Snapshoty: Pro a proti

- 👍 Snadná údržba a rychlá iterace <!-- .element: class="fragment li-emoji" -->
- 👍 Testování legacy kódu <!-- .element: class="fragment li-emoji" -->
- 👎 Křehkost při velkých změnách <!-- .element: class="fragment li-emoji" -->
- 👎 Není zřejmé, co je důležité <!-- .element: class="fragment li-emoji" -->
</script></section><section  data-markdown><script type="text/template">
Viz také

- [Gold Master Testing](https://codeclimate.com/blog/gold-master-testing/)
- [Guru Checks Output](http://wiki.c2.com/?GuruChecksOutput) (antipattern)
</script></section><section  data-markdown><script type="text/template">
## Proč zvolit Jest?

- 🤩 Rychlost, pohodlí a přívětivost <!-- .element: class="fragment li-emoji" -->
- 😊 React <!-- .element: class="fragment li-emoji" -->
- 🙂 Preprocesory <!-- .element: class="fragment li-emoji" -->
- 😏 jest-codemods <!-- .element: class="fragment li-emoji " -->
</script></section><section  data-markdown><script type="text/template">
## Proč nezvolit Jest?

- 🤨 Snapshoty <!-- .element: class="fragment li-emoji" -->
- 😕 Přizpůsobitelnost <!-- .element: class="fragment li-emoji" -->
- 😤 Integrační testy <!-- .element: class="fragment li-emoji" -->
- 🤯 Komplexita <!-- .element: class="fragment li-emoji" -->
</script></section><section  data-markdown><script type="text/template">
[github.com/jnv/talk-jest](https://github.com/jnv/talk-jest)

<!--
## Snaphoty v Mocha / Chai

- https://github.com/bahmutov/snap-shot-it
- https://github.com/wellguimaraes/mocha-snapshots
- https://github.com/suchipi/chai-jest-snapshot
- https://github.com/marvinhagemeister/chai-snapshot-tests
-->
</script></section></div>
    </div>

    <script src="./../dist/reveal.js"></script>

    <script src="./../plugin/markdown/markdown.js"></script>
    <script src="./../plugin/highlight/highlight.js"></script>
    <script src="./../plugin/zoom/zoom.js"></script>
    <script src="./../plugin/notes/notes.js"></script>
    <script src="./../plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {"transition":"fade","controls":false}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
